<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ… Test Completo: Fix Daily Ingredients</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f8ff; }
        .header { text-align: center; margin-bottom: 30px; }
        .success { color: #28a745; }
        .section { margin: 20px 0; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .product-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .product-card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; }
        .product-title { font-weight: bold; margin-bottom: 10px; }
        .ingredients-list { background: #f8f9fa; padding: 10px; border-radius: 5px; }
        .ingredients-list li { padding: 2px 0; }
        .has-ingredients { border-left: 4px solid #28a745; }
        .no-ingredients { border-left: 4px solid #dc3545; }
        .test-result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .instructions { background: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; margin: 10px 0; }
        .summary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="success">âœ… FIX COMPLETADO: Ingredientes de Productos Daily</h1>
        <p>Test exhaustivo para verificar que los productos Daily ahora muestran ingredientes correctamente</p>
    </div>

    <div class="section">
        <h2>ğŸ¯ Resumen del Problema y SoluciÃ³n</h2>
        <div class="summary">
            <h3>Problema Identificado:</h3>
            <ul>
                <li>Los productos Daily tenÃ­an arrays de ingredientes vacÃ­os <code>[]</code></li>
                <li>Productos como Omega sÃ­ mostraban ingredientes correctamente</li>
                <li>Esto causaba que las tarjetas de productos Daily mostraran "InformaciÃ³n no disponible"</li>
            </ul>

            <h3>SoluciÃ³n Aplicada:</h3>
            <ul>
                <li>Se agregaron 10 ingredientes relevantes para cada producto Daily</li>
                <li>Se actualizaron las keywords para mejorar la bÃºsqueda</li>
                <li>Se creÃ³ backup para seguridad</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ“‹ Instrucciones para Verificar el Fix</h2>
        <div class="instructions">
            <h3>1. En el Servidor Local:</h3>
            <ol>
                <li>Inicia el servidor: <code>python -m http.server 9003</code></li>
                <li>Abre: <a href="http://localhost:9003/index.html" target="_blank">http://localhost:9003/index.html</a></li>
                <li>Busca "Daily" - deberÃ­as ver ingredientes</li>
                <li>Busca "vitaminas" - deberÃ­a encontrar productos Daily</li>
            </ol>

            <h3>2. En la Consola del Navegador:</h3>
            <ol>
                <li>Abre herramientas de desarrollador (F12)</li>
                <li>Ve a Console</li>
                <li>Ejecuta el script de prueba de abajo</li>
            </ol>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ§ª Test de VerificaciÃ³n</h2>
        <button onclick="runComprehensiveTest()">ğŸš€ Ejecutar Test Completo</button>
        <button onclick="verifyDailyProducts()">ğŸ” Verificar Productos Daily</button>
        <button onclick="compareWithOmega()">ğŸ“Š Comparar con Omega</button>
        <div id="test-results"></div>
    </div>

    <div class="section">
        <h2>ğŸ“Š ComparaciÃ³n: Antes vs DespuÃ©s</h2>
        <div class="product-comparison">
            <div>
                <h3>ğŸ“± Productos Daily (Fix Aplicado)</h3>
                <div id="daily-after"></div>
            </div>
            <div>
                <h3>ğŸŸ Productos Omega (Referencia)</h3>
                <div id="omega-reference"></div>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ”§ Scripts de Mantenimiento</h2>
        <div class="code">
            <h4>Para aplicar el fix en tiempo real (browser):</h4>
            <button onclick="copyBrowserScript()">ğŸ“‹ Copiar Script del Navegador</button>
            <pre id="browser-script">
// Abrir http://localhost:9003/index.html
// Abrir F12 â†’ Console
// Pegar y ejecutar el script fix-daily-ingredients-browser.js
            </pre>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ“„ Archivos Modificados</h2>
        <ul>
            <li><strong>js/search-local.js</strong> - Archivo principal actualizado con ingredientes</li>
            <li><strong>js/search-local.js.backup</strong> - Backup del archivo original</li>
            <li><strong>fix-daily-ingredients.js</strong> - Script Node.js para aplicar el fix</li>
            <li><strong>fix-daily-ingredients-browser.js</strong> - Script para browser</li>
            <li><strong>daily-ingredients-fix-report.json</strong> - Reporte del fix</li>
        </ul>
    </div>

    <!-- Scripts -->
    <script src="js/search-local.js"></script>
    <script src="js/fuzzy-search.js"></script>

    <script>
        let testResults = [];

        function log(message, type = 'info') {
            testResults.push({ message, type, timestamp: new Date().toLocaleTimeString() });
            console.log(message);
            updateTestDisplay();
        }

        function updateTestDisplay() {
            const resultsDiv = document.getElementById('test-results');
            const latestResults = testResults.slice(-10);
            resultsDiv.innerHTML = latestResults.map(result =>
                `<div class="test-result ${result.type === 'error' ? 'fail' : result.type === 'success' ? 'pass' : ''}">
                    [${result.timestamp}] ${result.message}
                </div>`
            ).join('');
        }

        function runComprehensiveTest() {
            log('ğŸš€ Iniciando test completo del fix Daily...', 'info');

            setTimeout(() => {
                // Test 1: Verificar motor de bÃºsqueda
                if (!window.localSearchEngine) {
                    log('âŒ Motor de bÃºsqueda no disponible', 'error');
                    return;
                }
                log('âœ… Motor de bÃºsqueda disponible', 'success');

                // Test 2: Contar productos Daily
                const dailyProducts = window.localSearchEngine.data.pdfs.filter(pdf =>
                    pdf.title && pdf.title.toLowerCase().includes('daily')
                );
                log(`ğŸ“Š Encontrados ${dailyProducts.length} productos Daily`, 'info');

                // Test 3: Verificar ingredientes
                const withIngredients = dailyProducts.filter(p => p.ingredients && p.ingredients.length > 0);
                const withoutIngredients = dailyProducts.filter(p => !p.ingredients || p.ingredients.length === 0);

                if (withIngredients.length === dailyProducts.length && dailyProducts.length > 0) {
                    log(`âœ… Â¡EXITO! Todos los productos Daily (${withIngredients.length}) tienen ingredientes`, 'success');
                } else {
                    log(`âš ï¸ ${withoutIngredients.length} productos Daily todavÃ­a sin ingredientes`, 'error');
                }

                // Test 4: Verificar keywords
                const withGoodKeywords = dailyProducts.filter(p =>
                    p.keywords && p.keywords.some(k => k.includes('vitamin') || k.includes('mineral'))
                );
                log(`ğŸ“ˆ ${withGoodKeywords.length} productos Daily con keywords mejoradas`, 'info');

                // Test 5: Simular bÃºsqueda
                if (window.performSearch) {
                    const searchResults = window.performSearch('Daily');
                    log(`ğŸ” BÃºsqueda "Daily" devuelve ${searchResults.length} resultados`, 'info');

                    const resultsWithIngredients = searchResults.filter(r => r.ingredients && r.ingredients.length > 0);
                    log(`ğŸ“‹ ${resultsWithIngredients.length} resultados con ingredientes visibles`, 'success');
                }

                // Test 6: Comparar con Omega
                const omegaProducts = window.localSearchEngine.data.pdfs.filter(pdf =>
                    pdf.title && (pdf.title.toLowerCase().includes('omega') ||
                    pdf.keywords.some(k => k.includes('omega')))
                );
                const omegaWithIngredients = omegaProducts.filter(p => p.ingredients && p.ingredients.length > 0);
                log(`ğŸŸ Referencia: ${omegaWithIngredients.length}/${omegaProducts.length} productos Omega tienen ingredientes`, 'info');

                // Veredicto final
                if (withIngredients.length === dailyProducts.length && dailyProducts.length > 0) {
                    log('ğŸ‰ Â¡FIX VERIFICADO CON Ã‰XITO!', 'success');
                    log('Los productos Daily ahora muestran ingredientes correctamente', 'success');
                } else {
                    log('âŒ El fix necesita revisiÃ³n', 'error');
                }

            }, 1000);
        }

        function verifyDailyProducts() {
            if (!window.localSearchEngine) {
                log('âŒ Motor de bÃºsqueda no disponible', 'error');
                return;
            }

            const dailyProducts = window.localSearchEngine.data.pdfs.filter(pdf =>
                pdf.title && pdf.title.toLowerCase().includes('daily')
            );

            const dailyDiv = document.getElementById('daily-after');
            dailyDiv.innerHTML = dailyProducts.map(product => {
                const hasIngredients = product.ingredients && product.ingredients.length > 0;
                const statusIcon = hasIngredients ? 'âœ…' : 'âŒ';
                const borderColor = hasIngredients ? '#28a745' : '#dc3545';

                return `
                    <div class="product-card" style="border-left-color: ${borderColor};">
                        <div class="product-title">${statusIcon} ${product.title}</div>
                        <div><strong>Ingredientes:</strong> ${hasIngredients ? product.ingredients.length : 0}</div>
                        <div class="ingredients-list">
                            ${hasIngredients ?
                                product.ingredients.slice(0, 5).map(ing => `<li>â€¢ ${ing}</li>`).join('') :
                                '<li style="color: red;">âŒ Sin ingredientes</li>'
                            }
                        </div>
                    </div>
                `;
            }).join('');

            log(`ğŸ“Š Mostrados ${dailyProducts.length} productos Daily`, 'info');
        }

        function compareWithOmega() {
            if (!window.localSearchEngine) {
                log('âŒ Motor de bÃºsqueda no disponible', 'error');
                return;
            }

            const omegaProducts = window.localSearchEngine.data.pdfs.filter(pdf =>
                pdf.title && (pdf.title.toLowerCase().includes('omega') ||
                pdf.keywords.some(k => k.includes('omega')))
            );

            const omegaDiv = document.getElementById('omega-reference');
            omegaDiv.innerHTML = omegaProducts.slice(0, 3).map(product => {
                const hasIngredients = product.ingredients && product.ingredients.length > 0;
                const statusIcon = hasIngredients ? 'âœ…' : 'âŒ';
                const borderColor = hasIngredients ? '#28a745' : '#dc3545';

                return `
                    <div class="product-card" style="border-left-color: ${borderColor};">
                        <div class="product-title">${statusIcon} ${product.title}</div>
                        <div><strong>Ingredientes:</strong> ${hasIngredients ? product.ingredients.length : 0}</div>
                        <div class="ingredients-list">
                            ${hasIngredients ?
                                product.ingredients.slice(0, 5).map(ing => `<li>â€¢ ${ing}</li>`).join('') :
                                '<li style="color: red;">âŒ Sin ingredientes</li>'
                            }
                        </div>
                    </div>
                `;
            }).join('');

            log(`ğŸ“Š Mostrados ${Math.min(omegaProducts.length, 3)} productos Omega como referencia`, 'info');
        }

        function copyBrowserScript() {
            const scriptText = document.getElementById('browser-script').textContent;
            navigator.clipboard.writeText(scriptText).then(() => {
                log('ğŸ“‹ Script copiado al portapapeles', 'success');
            }).catch(() => {
                log('âŒ Error al copiar script', 'error');
            });
        }

        // Auto-ejecutar test cuando la pÃ¡gina cargue
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Test Daily Ingredients Fix cargado', 'info');

            setTimeout(() => {
                verifyDailyProducts();
                compareWithOmega();
            }, 1000);
        });
    </script>
</body>
</html>